/*
 * Copyright (C) 2009-2023 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["scm/ewm/packoutbdlvs1/controller/BaseController","sap/tl/ewm/lib/reuses1/controllers/Base.controller","scm/ewm/packoutbdlvs1/utils/Util","scm/ewm/packoutbdlvs1/service/ODataService","scm/ewm/packoutbdlvs1/modelHelper/OData","scm/ewm/packoutbdlvs1/utils/Const","sap/ui/model/json/JSONModel","scm/ewm/packoutbdlvs1/model/Message","scm/ewm/packoutbdlvs1/modelHelper/Message","sap/m/MessagePopoverItem","sap/m/MessagePopover","sap/m/MessageBox","scm/ewm/packoutbdlvs1/modelHelper/Global","scm/ewm/packoutbdlvs1/model/SerialNumber","scm/ewm/packoutbdlvs1/workflows/SimpleFactory","scm/ewm/packoutbdlvs1/workflows/AdvancedFactory","scm/ewm/packoutbdlvs1/modelHelper/PackingMode","scm/ewm/packoutbdlvs1/modelHelper/Material","scm/ewm/packoutbdlvs1/modelHelper/OData"],function(C,a,U,S,O,b,J,M,c,d,e,f,G,g,h,A,P,i,j){"use strict";var w="workcenter--input";var s="storagebin--input";return C.extend("scm.ewm.packoutbdlvs1.controller.BaseMain",{sRouteName:"main",init:function(){a.prototype.initAccessCode.call(this);this.setButtonToolTip("leave-button");},initModel:function(){this.setModel(g,"serialNum");this.setModel(M,"message");},onMessagePopoverPress:function(E){if(!this.oMessagePopover){this.initMessagePopover();}this.oMessagePopover.toggle(E.getSource());},initMessagePopover:function(){var m=new d({type:'{type}',title:'{text}'});var o=new e({items:{path:'/',template:m}});o.setModel(M);this.oMessagePopover=o;},formatTitle:function(B,W,k){if(U.isEmpty(k)||U.isEmpty(W)||U.isEmpty(B)){return"";}return this.getI18nText("pageTitle",[B,W,k]);},onLeave:function(E){var H=!U.isEmpty(G.getCurrentShipHandlingUnit());var W=H?this.getTextAccordingToMode("leaveMsgSaveHU","leaveMsgSaveShipHU"):this.getI18nText("leaveMsgWhenNoShipHU");this.playAudio(b.WARNING);f.warning(W,{actions:[f.Action.OK,f.Action.CANCEL],onClose:function(o){if(o===f.Action.OK){this.setBusy(true);this.oWorkFlowFactory.getLeaveWorkFlow().run();}}.bind(this)});},leavePage:function(E){var H=!U.isEmpty(G.getCurrentShipHandlingUnit());var o=this.getOwnerComponent();if(H){var W=this.getI18nText("leavePageMsg");this.playAudio(b.WARNING);f.warning(W,{actions:[f.Action.OK,f.Action.CANCEL],onClose:function(k){if(k===f.Action.OK){this.navBack(o);}}.bind(this)});}else{this.navBack(o);}},navBack:function(o){this.bindInputInDefaultBin(o);o.navigateBack.call(o,arguments);},bindInputInDefaultBin:function(o){var k=o.getId();var W=sap.ui.getCore().byId(k+b.ID.DEFAULT_BIN_VIEW+w);if(U.isEmpty(W)){return;}var l=W.getProperty("value");if(U.isEmpty(l)){return;}var m=j.encodeSpecialCharacter(l);W.bindElement({path:"/PackingStationSet(EWMWarehouse='"+G.getWarehouseNumber()+"',EWMWorkCenter='"+m+"',EWMStorageBin='')"});var n=sap.ui.getCore().byId(k+b.ID.DEFAULT_BIN_VIEW+s);n.bindElement({path:"/PackingStationSet(EWMWarehouse='"+G.getWarehouseNumber()+"',EWMWorkCenter='"+m+"',EWMStorageBin='')"});},onRouteMatched:function(){this.getOwnerComponent().getService("ShellUIService").then(function(o){o.setBackNavigation(this.leavePage.bind(this));}.bind(this),function(E){jQuery.sap.log.error("Cannot get ShellUIService",E);});}});});
