/*
 * Copyright (C) 2009-2023 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["scm/ewm/packoutbdlvs1/workflows/MixedWorkFlow","scm/ewm/packoutbdlvs1/utils/Util","scm/ewm/packoutbdlvs1/utils/Const","scm/ewm/packoutbdlvs1/modelHelper/Message","scm/ewm/packoutbdlvs1/service/ODataService","scm/ewm/packoutbdlvs1/modelHelper/Cache","scm/ewm/packoutbdlvs1/modelHelper/Global"],function(W,U,C,M,S,a,G){"use strict";return function(s,o){var w=new W().then(function(){this.setBusy(true);return this.flushPendings();},o,"flush the uncommitted pack items to the server before really sending close hu request").then(function(p,P){this.setBusy(true);return S.closeShipHandlingUnit();},o).then(function(p,m){if(p.MsgVar===""){var c=G.getCurrentShipHandlingUnit();var b=this.getTextAccordingToMode("closeHU","closeShippingHU",[c]);M.addSuccess(b);this.playAudio(C.INFO);}},o,"show success message only when the ship hu is already closed before displayed on the ui ").then(function(){a.clearShipHU(G.getCurrentShipHandlingUnit());this.removeTabAfterClose(G.getCurrentShipHandlingUnit());},o).then(function(p,P){P.bSourceEmpty=this.oItemHelper.isEmpty();},s,"get if source hu is empty").then(function(p,P){if(!P.bSourceEmpty){this.autoCreateShipHUAfterClose();}else{this.resetMaterialButtons();}this.deleteCurrentShipHandlingUnit();this.setCurrentShipHandlingUnit("");},o).then(function(p,P){if(!this.oItemHelper.isEmpty()){this.oItemHelper.setItemsDefaultQuan();}},s).then(function(p,P){P.sODO="";P.sPackInstr="";if(this.oItemHelper.getHighLightedItemIndex()===0){P.sODO=this.oItemHelper.getItemDocNoByIndex(0);P.sPackInstr=this.oItemHelper.getItemPackInstrByIndex(0);}},s).then(function(p,P){this.updatePackingInstr(P.sODO,P.sPackInstr);},o,"update packing info").then(function(){this.setBusy(false);},o);w.errors().default(function(e,p,m,c){if(c){this.showErrorMessagePopup(e);}},s).always(function(){this.setBusy(false);this.playAudio(C.ERROR);},s);return w;};});
