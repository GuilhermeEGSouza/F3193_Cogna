/*
 * Copyright (C) 2009-2023 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["scm/ewm/packoutbdlvs1/workflows/WorkFlow","scm/ewm/packoutbdlvs1/service/ODataService","scm/ewm/packoutbdlvs1/utils/Util","scm/ewm/packoutbdlvs1/utils/Const","scm/ewm/packoutbdlvs1/modelHelper/Message","scm/ewm/packoutbdlvs1/modelHelper/Global","scm/ewm/packoutbdlvs1/modelHelper/Cache","scm/ewm/packoutbdlvs1/modelHelper/Material"],function(W,S,U,C,M,G,a,b){"use strict";return function(s,o){var w=new W().then(function(h,m){m.sHuId=h;if(!this.oItemHelper.isEmpty()){m.mItems=this.oItemHelper.getAllItems();return this.flushPendings();}},o).then(function(p,m){this.setBusy(true);return S.changeMaterial("");},o).then(function(p,m){m.sNewHuId=p.HuId;G.changeShipHandlingUnit(m.sHuId,p.HuId);this.setCurrentShipHandlingUnit(p.HuId);return this.recreateTab(m.sHuId,p.HuId,true);},o).then(function(p,m){this.updateMaterialButtonsAfterChange();this.updateCurrentMaterialAfterChange();this.clearGrossWeight();},o).then(function(p,P){P.sODO="";P.sPackInstr="";if(this.oItemHelper.getHighLightedItemIndex()===0){P.sODO=this.oItemHelper.getItemDocNoByIndex(0);P.sPackInstr=this.oItemHelper.getItemPackInstrByIndex(0);}},s).then(function(p,P){this.updatePackingInstr(P.sODO,P.sPackInstr);},o,"update packing info").then(function(p,m){this.setBusy(false);var c=this.getTextAccordingToMode("changeHUMaterialSuccessfulMsg","changeShipHUMaterialSuccessfulMsg",[m.sNewHuId]);M.addSuccess(c);this.playAudio(C.INFO);},o);w.errors().default(function(e,p,m,c){if(c){this.showErrorMessagePopup(e);}},s).always(function(e,p,m){this.setBusy(false);this.clearGrossWeight();if(!U.isEmpty(p.PackagingMaterial)){b.setFavoriteMaterialSelectedById(b.getCurrentMaterialId(),false);var c=b.getMaterialById(p.PackagingMaterial);b.setCurrentMaterial(c);b.setFavoriteMaterialSelectedById(p.PackagingMaterial,true);}if(!U.isEmpty(p.HuId)){S.getHUItems(p.HuId,C.SHIP_TYPE_HU).then(function(i){this.oItemHelper.setItems(i);if(i.length!==0){a.updateShipHUConsGroup(p.HuId,i[0].EWMConsolidationGroup);this.updateShipItemStatus();}else{a.updateShipHUConsGroup(p.HuId,"");}this.oItemHelper.setItemsPreviousAlterQuan();this.oItemHelper.setItemsDefaultQuan(m.mItems);this.oItemHelper.setItemsDeltaQuan();this.oItemHelper.setItemsPackedQuan();}.bind(this)).catch(function(E){});}this.playAudio(C.ERROR);},o);return w;};});
