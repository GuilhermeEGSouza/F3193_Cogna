/*
 * Copyright (C) 2009-2023 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["scm/ewm/packoutbdlvs1/workflows/WorkFlow","scm/ewm/packoutbdlvs1/utils/Util","scm/ewm/packoutbdlvs1/utils/Const","scm/ewm/packoutbdlvs1/modelHelper/Message","scm/ewm/packoutbdlvs1/service/ODataService","scm/ewm/packoutbdlvs1/modelHelper/Global","scm/ewm/packoutbdlvs1/modelHelper/Cache"],function(W,U,C,M,S,G,a){"use strict";return function(s,o){var w=new W().then(function(d,m){m.oDeleteInfo=d;m.HU=G.getCurrentShipHandlingUnit();if(d.bCallService){return S.deleteShippingHU();}},o,"call delete ship hu service based on the indicator").then(function(p,P){this.setBusy(false);var d=G.getCurrentShipHandlingUnit();a.clearShipHU(d);this.deleteCurrentShipHandlingUnit();return this.removeTabByTabName(d);},o,"delete items from ship table, delete current shipHU from Global").then(function(p,P){if(G.hasOpenShipHandlingUnit()){var b=G.getShipHandlingUnits()[0];this.setCurrentShipHandlingUnit(b);return this.selectTabByTabName(b);}},o,"select next ship handling unit").then(function(p,P){if(!G.hasOpenShipHandlingUnit()){this.oInitTab.setVisible(true);this.setCurrentShipHandlingUnit("");this.handleUnpackEnable();}},o,"display the intial tab").then(function(p,m){if(m.oDeleteInfo.bCallService){var b=this.getTextAccordingToMode("deleteHuSuccessMsg","deleteShipHuSuccessMsg",m.HU);M.addSuccess(b);this.playAudio(C.INFO);}},o).then(function(p,P){if(P.oDeleteInfo.bRefreshSource){return this.getWorkFlowFactory().getSourceChangeWorkFlow().run({sReferenceNumber:G.getSourceId(),bReferenceNumberValidated:true});}},s,"refresh the left side").then(function(p,P){P.sConGroupOfFirstSourceItem="";if(!U.isEmpty(G.getSourceId())&&!this.oItemHelper.isEmpty()){P.sConGroupOfFirstSourceItem=this.oItemHelper.getFirstItemConsGroup();}},s,"get consolidation group of the selected source product").then(function(p,m){this.dehilightShipHandlingUnits();if(!U.isEmpty(G.getProductId())){var h=this.getHightlightShipHandlingUnits(m.sConGroupOfFirstSourceItem);if(h.length>0){this.hilightShipHandlingUnits(h);}}},o,"highlight ship handling unit if possible").then(function(){this.focus(C.ID.PRODUCT_INPUT);this.oItemHelper.setItemsStatusByConsGrp();this.handleExceptionEnable();this.updateSourceItemStatus();this.handlePackAllEnable();},s).then(function(p,P){P.bHasSourceItem=!this.oItemHelper.isEmpty();},s).then(function(p,P){if(P.bHasSourceItem&&this.needAutoCreateShippingHU(P.sConGroupOfFirstSourceItem)){this.onOpenCreateShipHUDialog();}},o,"open createshiphu dialog if there is no open ship hu").then(function(p,P){P.sODO="";P.sPackInstr="";if(this.oItemHelper.getHighLightedItemIndex()===0){P.sODO=this.oItemHelper.getItemDocNoByIndex(0);P.sPackInstr=this.oItemHelper.getItemPackInstrByIndex(0);}},s).then(function(p,P){this.updatePackingInstr(P.sODO,P.sPackInstr);this.updateInputWithDefault(C.ID.SHIP_INPUT,"");},o,"update packing info");w.errors().default(function(e,p,m,c){if(c){this.showErrorMessagePopup(e);}},s).always(function(){this.setBusy(false);this.playAudio(C.ERROR);},o);return w;};});
