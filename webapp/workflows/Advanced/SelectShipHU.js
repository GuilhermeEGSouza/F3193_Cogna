/*
 * Copyright (C) 2009-2023 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["scm/ewm/packoutbdlvs1/workflows/WorkFlow","scm/ewm/packoutbdlvs1/modelHelper/Global","scm/ewm/packoutbdlvs1/utils/Util","scm/ewm/packoutbdlvs1/modelHelper/Cache","scm/ewm/packoutbdlvs1/utils/Const","scm/ewm/packoutbdlvs1/service/ODataService"],function(W,G,U,C,a,S){"use strict";return function(s,o){var w=new W().then(function(h,p){p.Huid=h;return this.updateTabContent(h);},o).then(function(p,P){return S.getHUSet(P.Huid,a.SHIP_TYPE_HU);},o).then(function(p,P){P.NetWeight=p.NetWeight;P.WeightUoM=p.WeightUoM;},o).then(function(p,P){this.updateNetWeightRelated(P.NetWeight,P.WeightUoM);},o,"update weight chart, color and text").then(function(p,P){this.updateShipItemStatus();},o).then(function(p,P){this.updateSourceItemStatus();if(U.isEmpty(G.getSourceId())){this.focus(a.ID.SOURCE_INPUT);}else{this.focus(a.ID.PRODUCT_INPUT);}},s).then(function(p,P){P.sODO="";P.sPackInstr="";if(this.oItemHelper.getHighLightedItemIndex()===0){P.sODO=this.oItemHelper.getItemDocNoByIndex(0);P.sPackInstr=this.oItemHelper.getItemPackInstrByIndex(0);}},s).then(function(p,P){this.updatePackingInstr(P.sODO,P.sPackInstr);},o,"update packing info").then(function(p,P){this.updateCacheIsEmptyHU();},o,"update cache").then(function(p,P){var b=G.getSelectedProductInShip();if(!U.isEmpty(b)){var i=this.oItemHelper.getItemIndexByKey(b.StockItemUUID,P.Huid);if(i>=0){this.oItemHelper.setItemsStatusToNone();this.oItemHelper.setItemHighlightByIndex(i);}G.setSelectedProductInShip("");}},o,"highlight specific item in the ship table").then(function(p,m){this.delayCalledAdjustContainerHeight();},o);w.errors().subscribe(a.ERRORS.NO_AUTHORIZATION_FOR_WAREHOUSE,function(e){this.showToLeaveMessagePopup(e);},s).default(function(e){this.updateInputWithError(a.ID.SHIP_INPUT,e);},o).always(function(){G.setBusy(false);this.playAudio(a.ERROR);},o);return w;};});
