/*
 * Copyright (C) 2009-2023 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["scm/ewm/packoutbdlvs1/workflows/WorkFlow","scm/ewm/packoutbdlvs1/service/ODataService","scm/ewm/packoutbdlvs1/modelHelper/Global","scm/ewm/packoutbdlvs1/modelHelper/SerialNumber","scm/ewm/packoutbdlvs1/modelHelper/Cache","scm/ewm/packoutbdlvs1/utils/Util","scm/ewm/packoutbdlvs1/utils/Const","scm/ewm/packoutbdlvs1/modelHelper/Message"],function(W,S,G,a,C,U,b,M){"use strict";return function(s,o){var w=new W().then(function(p,m){m.oProduct=p[0];m.fDiffPackQty=p[1];m.sExccode=p[2];m.oDialog=p[3];m.sUoM=p[4];m.sUoMType=p[5];m.iQuantity=m.fDiffPackQty;if(!U.isEmpty(m.oProduct.SerialNumberRequiredLevel)){var P=a.convertSerialNumbersToString();if(m.oProduct.isIuidActive===b.ABAP_TRUE){m.oProduct.IuidList=a.getPackedUiis(m.oProduct.SnList.split(" "),m.oProduct.IuidList.split(" "),P.split(" "));}m.oProduct.SnList=P;}},s,"set mSession").then(function(){return this.updateItemWeightInNeed();},s,"check if there exists source item which is not in ItemWeight").then(function(p,m){return S.exceptionPack(m.oProduct,m.fDiffPackQty,m.sExccode,m.sUoM);},s).then(function(p,m){m.oDialog.setBusy(false);this.closeDialog(m.oDialog);m.NetWeight=p.NetWeight;m.WeightUoM=p.WeightUoM;this.oItemHelper.deleteItem(m.oProduct);m.oProduct=this.getNewItemWithPartialQuantity(m.oProduct,p);G.setProductId("");G.setExceptionEnable(false);},s).then(function(p,m){this.unbindProductInfo();},s).then(function(p,m){this.unbindODOInfo();if(!this.oItemHelper.isEmpty()){this.bindODOInfo();}this.focus(b.ID.PRODUCT_INPUT);},s).then(function(p,m){if((m.oProduct.SerialNumberRequiredLevel===b.SN_DOC_LEVEL_PROFILE_A&&m.oProduct.EWMDeliveryDocumentCategory===b.DOCUMENT_CAT_OUTBOUND)||m.oProduct.SerialNumberRequiredLevel===b.SN_DOC_LEVEL_PROFILE_B){this.oItemHelper.removeSerialNumberFromOtherItems(m.oProduct.ProductName,a.getAllSerialNumerKeys());}},s).then(function(p,m){this.updateInputWithDefault(b.ID.SHIP_INPUT,"");m.bShipHUEmptyBeforePack=this.oItemHelper.isEmpty();if(m.iQuantity!==0){this.oItemHelper.updateItem(m.oProduct);this.oItemHelper.setItemsStatusToNone();this.oItemHelper.setItemHighlightByIndex(0);}this.handleUnpackEnable();},o).then(function(p,m){this.updateNetWeightRelated(m.NetWeight,m.WeightUoM);this.clearGrossWeight();},o,"update weight chart, color and text").then(function(){this.dehilightShipHandlingUnits();},o).then(function(p,m){if(m.bShipHUEmptyBeforePack&&m.iQuantity!==0){C.updateShipHUConsGroup(G.getCurrentShipHandlingUnit(),m.oProduct.EWMConsolidationGroup);}},o).then(function(p,P){this.clearPackingInstr();},o,"update packing info").then(function(p,P){this.updateCacheIsEmptyHU();},o,"update cache").then(function(){this.handlePackAllEnable();},s).then(function(p,m){this.delayCalledAdjustContainerHeight();},o);w.errors().default(function(e,p,m,c){if(c){this.showErrorMessagePopup(e);}},s).always(function(e,p,m){m.oDialog.setBusy(false);this.closeDialog(m.oDialog);this.focus(b.ID.PRODUCT_INPUT);this.playAudio(b.ERROR);if(!U.isEmpty(G.getSourceId())){G.setExceptionEnable(false);S.getHUItems(G.getSourceId()).then(function(i){if(i[0]){this.oItemHelper.setItems(i);this.oItemHelper.sortItemsByKey(m.oProduct.StockItemUUID,m.oProduct.Huident);this.bindODOInfo();this.oItemHelper.setItemsStatusByConsGrp();}}.bind(this)).catch(function(E){});}},s);return w;};});
