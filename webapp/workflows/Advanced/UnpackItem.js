/*
 * Copyright (C) 2009-2023 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["scm/ewm/packoutbdlvs1/workflows/WorkFlow","scm/ewm/packoutbdlvs1/utils/Util","scm/ewm/packoutbdlvs1/utils/Const","scm/ewm/packoutbdlvs1/utils/CustomError","scm/ewm/packoutbdlvs1/modelHelper/Message","scm/ewm/packoutbdlvs1/service/ODataService","scm/ewm/packoutbdlvs1/modelHelper/Cache","scm/ewm/packoutbdlvs1/modelHelper/Global"],function(W,U,C,a,M,S,b,G){"use strict";return function(s,o){var w=new W().then(function(p,P){P.oProduct=p;return S.unpack(p);},o,"call backend service").then(function(p,P){P.StockItemUUID=p.StockItemUUID;return p;}).then(o.unpackCallback,o,"delete the ship hu from ui and interupt the following actions, if it is deleted from backend").then(function(p,P){this.updateInputWithDefault(C.ID.SHIP_INPUT,"");this.updateNetWeightRelated(p.NetWeight,p.WeightUoM);this.clearGrossWeight();},o,"update weight chart, color and text").then(function(p,P){this.oItemHelper.deleteItem(P.oProduct);},o,"remove product from right table").then(function(){if(this.oItemHelper.isEmpty()){b.updateShipHUConsGroup(G.getCurrentShipHandlingUnit(),"");this.updateScaleWeight("");}},o,"clear ship side if it is empty after unpack").then(function(){this.dehilightShipHandlingUnits();},o).then(function(){if(!this.oItemHelper.isEmpty()){this.oItemHelper.setItemHighlightByIndex(0);}this.handleUnpackEnable();},o,"set item hightlight").then(function(p,P){return this.handleUnpackItemsWithDifferentODO(P.oProduct);},o,"if source is ODO, ship items with different odo will be unpack to bin").then(function(p,P){return S.getHUItems(G.getSourceId());},o).then(function(p,P){this.setBusy(false);this.oItemHelper.setItems(p);G.setProductId(P.oProduct.ProductName);this.oItemHelper.sortItemsByKey(P.StockItemUUID,P.oProduct.Huident);},s,"add item to the left table").then(function(){G.setExceptionEnable(true);this.oItemHelper.setItemsStatusByConsGrp();this.oItemHelper.setItemHighlightByIndex(0);},s).then(function(){this.bindODOInfo();this.bindImage();},s,"update odo").then(function(){this.bindProductInfo();this.focus(C.ID.PRODUCT_INPUT);},s,"update product info").then(function(p,m){if(this.oItemHelper.isEmpty()){var c=m.oProduct.EWMConsolidationGroup;this.hilightShipHandlingUnitsByConsolidationGroup(c);}},o,"trigger hilight ship hu as the current ship hu is empty and may ready for the coming product").then(function(p,P){P.sODO=this.oItemHelper.getItemDocNoByIndex(0);P.sPackInstr=this.oItemHelper.getItemPackInstrByIndex(0);},s).then(function(p,P){this.updatePackingInstr(P.sODO,P.sPackInstr);},o,"update packing info").then(function(p,P){this.updateCacheIsEmptyHU();},o,"update cache").then(function(){this.handlePackAllEnable();},s).then(function(p,m){this.delayCalledAdjustContainerHeight();},o);w.errors().default(function(e,p,m,c){if(c){this.showErrorMessagePopup(e);}},s).always(function(){this.setBusy(false);this.playAudio(C.ERROR);},s);return w;};});
